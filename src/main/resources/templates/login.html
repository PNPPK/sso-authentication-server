<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <script th:src="@{/webjars/lodash/4.17.21/lodash.js}"></script>
    <script th:src="@{/js/fingerprint2.min.js}"></script>
    <script th:src="@{/js/script.js}"></script>
    <link th:href="@{/webjars/font-awesome/5.15.3/css/all.css}" rel="stylesheet">
    <link th:href="@{/webjars/bulma/0.9.2/css/bulma.min.css}" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link th:href="@{/favicon.ico}" rel="icon">
    <title th:text="#{login.title}">Authentication server</title>
</head>
<body>
<noscript>
    <strong>We're sorry but this app doesn't work properly without JavaScript enabled. Please enable it to
        continue.</strong>
</noscript>
<div>
    <nav class="navbar is-primary sticky-navbar">
        <div class="navbar-brand">
            <span class="logo"><a th:href="@{/}" id="logo"><img th:src="@{/images/logo.png}"></a></span>
            <div class="simple-clock" id="time-block">
                <p id="time"></p>
            </div>
            <div class="navbar-burger" data-target="navMenu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div class="navbar-menu" id="navMenu">
            <div class="navbar-end">
                <span class="navbar-item" onclick="changeTouchStatus()" style="margin: 0 16px">
                    <i class="has-text-warning is-size-2 fas fa-keyboard" id="touch-keyboard"
                       style="display: none;"></i>
                    <i class="has-text-danger is-size-2 fas fa-keyboard" id="not-touch-keyboard"></i>
                </span>
            </div>
        </div>
    </nav>
    <div class="box">
        <div class="columns is-centered">
            <div class="column is-half-tablet is-one-third-desktop is-one-quarter-widescreen is-one-fifth-fullhd">
                <div th:if="${param.credentialsError}" class="notification is-danger">
                    <span th:text="${param.credentialsError}">Credentials error</span>
                </div>
                <div th:if="${param.successLogout}" class="notification is-primary">
                    Вы вышли из системы
                </div>
                <div class="box">
                    <form action="#" id="login_form" method="post" th:action="@{/do_login}">
                        <div class="field">
                            <label class="label">Имя пользователя</label>
                            <div class="control has-icons-left">
                                <input class="input" name="username" placeholder="Имя пользователя" type="text">
                                <span class="icon is-small is-left">
                                    <i class="fas fa-user"></i>
                                </span>
                            </div>
                        </div>
                        <div class="field">
                            <label class="label">Пароль</label>
                            <div class="control has-icons-left">
                                <input class="input" name="password" placeholder="Пароль" type="password">
                                <span class="icon is-small is-left">
                                    <i class="fas fa-lock"></i>
                                </span>
                            </div>
                        </div>
                        <div class="field">
                            <button class="button is-primary is-fullwidth" type="button" onclick="ssoLogin()">
                                Войти
                            </button>
                        </div>
                        <div class="field">
                            <button class="button is-light is-fullwidth" type="button" onclick="ldapLogin()">
                                Войти через корпоративный доступ
                            </button>
                        </div>
                        <input type="submit" hidden />
                        <input id="fp_input" name="_fingerprint" type="hidden" value="FP_PLACEHOLDER">
                        <input th:if="${param.continue != null}" name="_continue" type="hidden" th:value="${param.continue}">
                        <input th:if="${param.app != null}" name="_app" type="hidden" th:value="${param.app}">
                        <input id="authentication_mode" name="_authenticationMode" type="hidden" th:value="sso">
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function ssoLogin() {
       document.getElementById('authentication_mode').value = 'sso';
       submitLogin();
    }
    function ldapLogin() {
       document.getElementById('authentication_mode').value = 'ldap';
       submitLogin();
    }
    document.getElementById('login_form').onsubmit = submitLogin;
    function submitLogin(event) {
        if (event) {
            event.preventDefault();
        }
        getFingerprint()
           .then(result => {
               document.getElementById('fp_input').value = result;
               document.getElementById('login_form').submit();
           });
    }
</script>
<script th:src="@{/js/postscript.js}"></script>
</body>
</html>
